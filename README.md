# `libfix64`

A fast 64-bit (Q31.32) fixed point math library written in C99.

Implements basic arithmetic function, comparison, conversion, exponentiation, powers, trigonometry,
and more; including all relevant `math.h` functions for fixed point numbers.

> **Note:** This library is still a work in progress. Not all functionality is complete yet.

> **Note:** Currently only 64-bit architectures are supported since `libfix64` leverages native
64*64=128-bit multiplication for many functions.

## Usage

Source code for this project is autogenerated using a Python script.
Ensure Python 3.6 or later is installed on your system, and install the requirements by running:

~~~sh
python3 -m pip install -U -r requirements.txt
~~~

Generate C source code by running:

~~~sh
python3 generate.py
~~~

The generated source code can be found in the output directory.
The library can be compiled by running `make` in this directory.

Alternatively, the source code can be generated and compiled in one step by running:

~~~sh
python3 generate.py --build
~~~

## Development

### Implementation

Templates for C source code are located in the [src](src) directory.
These use the [Jinja2](https://palletsprojects.com/p/jinja/) templating language
to populate things like constants calculated at render time.

Templates are rendered using the scripts in the [scripts](scripts) directory.
The Python [mpmath](https://mpmath.org/) library is used for accurately calculating constants,
since a Python `float` or C `double` only have 53 bits of precision.

Most non-trivial mathematical functions are calculated using Chebyshev polynomials, although other
algorithms are used for certain functions where polynomial approximations are less suitable.

### Tests

Tests are in the [test](test) directory.
These are written in Python using [pytest](https://pytest.org)
and call the compiled libfix64 code using Python's builtin ctypes FFI library.

To launch the tests, run:

~~~sh
python3 generate.py --test
~~~
